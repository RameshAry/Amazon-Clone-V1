'use strict';mix_d("P13NAmazonBusinessFrontEndCards__p13n-deal-info:p13n-deal-info__Y7a6lbl4","exports tslib @c/scoped-dom @c/aui-carousel @c/dom @c/remote-operations @p/A @p/a-carousel-framework @c/aui-modal @c/aui-untrusted-ajax @c/browser-operations @c/logger @c/aui-utils @c/metrics @c/navigation @c/scoped-metrics".split(" "),function(x,k,C,D,E,F,G,H,I,J,K,L,ja,ka,M,t){function h(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var g=h(C),N=h(D),O=h(F),l=h(G),P=h(H),Q=h(I),R=h(J),
y=h(K),q=h(L),z=h(M),T=function(a){return k.__awaiter(void 0,void 0,void 0,function(){var b,c,d,f,e;return k.__generator(this,function(m){b=g["default"].cardRoot.querySelector(".report-problem-modal-root");if(!b)return[2];c={a11yOpenMessage:"A modal for internal users to report problems with recommendations",hideHeader:!1};d=Q["default"].create("report-flag-modal",".report-problem-modal-root",c);f=y["default"].setup();e=g["default"].cardRoot.querySelector(".report-flag");f.define("show","click",function(){d.show()});
f.attach("show",e);S(a,d);return[2]})})},S=function(a,b){var c=g["default"].cardRoot.querySelector(".report-flag"),d=y["default"].setup();d.define("showFlag","mouseover",function(){c.classList.remove("report-flag-hide")});d.define("hideFlag","mouseout",function(){c.classList.add("report-flag-hide")});d.attach("showFlag",a);d.attach("hideFlag",a);var f=g["default"].cardRoot.querySelector(".internal-flag-form");f.onsubmit=function(b){return U(f,b,a)};l["default"].on("a:dropdown:selected:internal-flag-dropdown-name",
function(a){f.querySelector(".internal-flag-env-data").setAttribute("data-problem-value",a.value)});l["default"].on("a:popover:hide:"+b.id,function(){f.reset();var a=f.querySelector(".internal-flag-alias").nextSibling;a&&a.classList.contains("report-problem-message")&&(a.innerText="")})},U=function(a,b,c){b.preventDefault();b=a.querySelector(".internal-flag-env-data").dataset;var d=a.querySelector(".internal-flag-dropdown").innerText,f=a.querySelector(".internal-flag-textarea").firstElementChild.value,
e=a.querySelector(".internal-flag-alias"),m=e.value;if(void 0===a.querySelector(".internal-flag-env-data").dataset.problemValue)return u(e,!1,"Please select a problem."),!1;a=g["default"].cardRoot.querySelectorAll(".a-carousel-card");var p=V(c,a.length);c="Internal user reported issue with your widget: "+g["default"].cardRoot.querySelector(".a-carousel-heading").innerText;d=W(a,p,d,f,m,b);R["default"].post("https://p13ngoals.corp.amazon.com/sims",{accepts:"text/html, application/json",contentType:"application/json;charset=UTF-8"},
{sim_params:{assigned_folder:"1b027359-e4c6-4e3c-92a8-0ff8a2ecb593",description:d,descriptionContentType:"text/amz-markdown-sim",tags:[{id:"internal-problem-generated"},{id:b.problemValue}],title:c}}).then(function(a){u(e,!0,a)}).catch(function(a){u(e,!1,a)});return!1},V=function(a,b){if(!a.dataset.aCarouselOptions)return q["default"].log("Empty ASIN List in carouselElement.dataset.aCarouselOptions","ERROR"),[];a=JSON.parse(a.dataset.aCarouselOptions).ajax.id_list;var c=g["default"].cardRoot.querySelector(".a-carousel-firstvisibleitem");
c=(Number(c.value)||1)-1;return a.map(function(a){return JSON.parse(a).id}).slice(c,c+b)},W=function(a,b,c,d,f,e){for(var m="",p=0;p<a.length;p++){var n=a[p].querySelector(".a-dynamic-image");m+=(n?"![]("+n.src+")":"IMAGE MISSING")+"\nASIN: "+(b[p]?b[p]:"ASIN MISSING")+"\n\n"}return"**This SIM issue is created by the 'Report a Problem' internal tool. To know more, here's its wiki: https://w.amazon.com/bin/view/Personalization/CoreRecommendations/Projects/Canaries/Report-a-Problem-UX-on-P13NWidget/UserGuide/**\n\n**Problem:** "+
(c+"\n"+(""!==d?"**Comment:** "+d+"\n":"")+"\n**Strategy ID:** "+e.strategyId+"\n**CTI:** "+e.cti+"\n**Facets:** ")+(e.facets+"\n**Content Reftag:** "+e.reftTag+"\n"+(""!==e.baseAsin?"**Page ASIN:** "+e.baseAsin+"\n":"")+"\n"+(""!==f?"**Alias:** ["+f+"](https://phonetool.amazon.com/users/"+f+")\n":"")+"**CustomerID:** "+e.customerId)+("\n**SessionID:** "+e.sessionId+"\n**MarketplaceID:** "+e.marketplaceId+"\n**Device Type:** "+e.deviceType+"\n\n**List of ASINs:**\n\n")+m},u=function(a,b,c){var d=
a.nextSibling;d&&d.classList.contains("report-problem-message")||(d=document.createElement("h5"),d.classList.add("report-problem-message"),a.after(d));b?(d.classList.remove("a-color-error"),c.responseBody&&"object"===typeof c.responseBody?c.responseBody.response&&c.responseBody.response.id?d.innerHTML="Success, here's the <a href=\"https://issues.amazon.com/issues/"+c.responseBody.response.id+'" target="_blank">SIM issue</a> you created.':(q["default"].log("Fail to find the id of the SIM issue created in the response body of response data.",
"ERROR"),d.innerText="Success, but we could not find the link to the SIM."):(q["default"].log("The response body of response data is not an object.","ERROR"),d.innerText="Success, but we could not find the link to the SIM.")):(d.classList.add("a-color-error"),d.innerText="string"===typeof c?c:"Oops! Something went wrong. Please try again.")},A=/(?=[ \-\/])|(?=[\u3105-\u312F])|(?=[\u31A0-\u31BA])|(?=[\u4E00-\u9FD5])|(?=[\u3400-\u4DB5])|(?=[\uF900-\uFAFF])|(?=[\u3040-\u309F])|(?=[\u30A0-\u30FF])|(?=[\u3190-\u319F])/,
B=/[^\/\-\[\]():\s]/,X=function(a){var b=l["default"].$("<div>")[0];b.classList.add("p13n-sc-offscreen-truncate");var c=parseInt(a.getAttribute("data-rows")||"2",10),d=function(){var b=a.innerHTML;a.innerHTML="&hellip;";var c=a.clientHeight;a.innerHTML=b;return c}();if(c){if(d){var f=function(a){b.innerHTML=a;return Math.round(b.clientHeight/d)<=c},e=function(c,d){c=c.split(d);var e=Math.floor(a.clientWidth/12),f=function(c){b.classList.add("p13n-sc-offscreen-truncate");b.style.overflow="hidden";
b.textContent=c;a.appendChild(b);c=a.clientWidth>=a.scrollWidth;a.removeChild(b);return c},m=function(a){var b=a.length-e;a.trim().length>e&&!f(a)&&Array.prototype.slice.call(a).map(function(a,c){return c>e&&c<=b&&B.test(a)?"&shy;"+a:a});return a};return c.map(function(a){return m(a)}).join("")};return{truncate:function(){var c=a.innerHTML.trim(),d=a.textContent||"";c=e(c,A);a.appendChild(b);if(f(c))a.removeChild(b),a.innerHTML=c;else{var n=c.split(A);for(var g=1,l=n.length,k,h,r=0;g!==l;)if(k=Math.floor((l+
g)/2),h=n.slice(0,k).join("")+"&hellip;",f(h)){if(1>=l-k){for(r=k;0<r&&!B.test(n[r-1]);)r--;break}g=k}else l=k;n=0===r?void 0:n.slice(0,r).join("")+"&hellip;";n?(a.innerHTML=n,a.setAttribute("title",d)):(q["default"].log("Unable to successfully truncate line "+c,"ERROR"),a.removeChild(b))}}}}q["default"].log("Truncation element does not have a line height or it is zero","ERROR")}else q["default"].log("Truncation element missing necessary line number data","ERROR")},Y=function(a){var b=Array.prototype.slice.call(a.getElementsByClassName("p13n-sc-truncate"));
a=a.getElementsByClassName("p13n-sc-truncate-fallback");(window.CSS&&CSS.supports&&CSS.supports("-webkit-line-clamp","1")?b:b.concat(Array.prototype.slice.call(a))).map(function(a){var b=X(a);b&&(b.truncate(),a.classList.add("p13n-sc-truncated"),a.classList.remove("p13n-sc-truncate"),a.classList.remove("p13n-sc-truncate-fallback"),a.className=a.className.replace(/p13n-sc-line-clamp-\d/g,""))})},Z={initCarousel:function(a){return k.__awaiter(void 0,void 0,void 0,function(){var b,c,d;return k.__generator(this,
function(f){b=(a||{}).afterPageLoaded;c=g["default"].cardRoot.classList.contains("p13n-sc-shoveler")?[g["default"].cardRoot]:Array.prototype.slice.call(g["default"].cardRoot.getElementsByClassName("p13n-sc-shoveler"));d=O["default"].setup(["getCarouselItems"]);if(null===c||void 0===c||!c.length)return[2];c.forEach(function(a){return k.__awaiter(void 0,void 0,void 0,function(){var c,e,f,g,h;return k.__generator(this,function(m){switch(m.label){case 0:if(a.classList.contains("p13n-carousel-initialized"))return[2];
a.classList.add("p13n-carousel-initialized");c=P["default"].getCarousel(E.unscope(a));e=N["default"].getCarousel(a);f=a.dataset||{};g=c.getAttr("name");h=function(){l["default"].loadDynamicImage("[data-name]='"+g+"' .p13n-sc-dynamic-image");Y(a);null===b||void 0===b?void 0:b(a)};return[4,Promise.all([e.initialized,T(a)])];case 1:return m.sent(),l["default"].on("a:carousel:"+g+":change:pageSize",h),l["default"].on("a:carousel:"+g+":change:loading",h),l["default"].on("a:carousel:"+g+":change:animating",
h),l["default"].on("a:carousel:"+g+":change:fetchedItems",h),h(),e.attachRemoteOperation(function(a){var b=a.indexes;a=a.ids;return d.getCarouselItems(k.__assign(k.__assign({},f),{ids:a,indexes:b,offset:String(b[0]||0)}))}),[2]}})})});return[2]})})}},aa=function(a){return function(b){a.forEach(function(a){a(b)})}},ea=function(){l["default"].declarative("quantity-input",["keyup"],ba);l["default"].declarative("popover-close",["click"],ca);l["default"].declarative("qd-row-click",["click"],da);g["default"].cardRoot.addEventListener("click",
function(a){a=a.target;(null===a||void 0===a?0:a.matches('[class*="qdMessage"]'))&&t.count("QDMessageClick:"+v,1)})},v=function(){return l["default"].capabilities.tablet?"Tablet":l["default"].capabilities.mobile?"Mobile":"Desktop"},da=function(a){var b=a.data.url;a=a.$target.context.closest('[class*="qdRow"],[class*="qdPlaceholderRow"]').dataset.quantity;t.count("PricingTableRowClick:"+v,1);z["default"].setLocation(b+"&qty="+a)},ca=function(){g["default"].cardRoot.click()},ba=function(a){var b,c,
d=parseInt(a.$target.val())||0;13===a.$event.keyCode&&0<d&&(t.count("QuantityInputEnter:"+v,1),z["default"].setLocation(a.data.url+"&qty="+d));a=a.$currentTarget.context.closest('[class*="qdPricingTableContainer"]');var f=a.querySelectorAll('[class*="qdRow"]');f.forEach(function(a){a.classList.add("aok-hidden")});for(var e=0,g=null,h=0;h<f.length;h++){var k=f[h];if(g&&1<=e||2<=e)break;var l=parseInt((null===(b=k.dataset)||void 0===b?void 0:b.quantity)||"")||0;d<l?(k.classList.remove("aok-hidden"),
e++):g=k}(parseInt((null===(c=f[f.length-1].dataset)||void 0===c?void 0:c.quantity)||"")||0)>d&&f[f.length-1].classList.remove("aok-hidden");fa(a,g,d)},fa=function(a,b,c){a=a.querySelector('[class*="qdPlaceholderRow"]');null===a||void 0===a?void 0:a.classList.add("aok-hidden");if(a&&b&&0<c){var d=b.querySelector('[class*="qdPrice"]').innerText;b=b.querySelector('[class*="qdSavingsMessage"]').innerText;var f=a.querySelector('[class*="minQuantity"]'),e=a.querySelector('[class*="qdPrice"]'),g=a.querySelector('[class*="qdSavingsMessage"]');
f.innerText=String(c);e.innerText=d;g.innerText=b;a.dataset.quantity=String(c);a.classList.remove("aok-hidden")}},w=function(a){return 0===Math.floor(a/10)?"0"+a.toString():a.toString()},ha=function(a){var b=a.querySelector('[class*="dealsCardDealTimer"]');if(null!==b){var c=b.dataset.endtime;c&&setInterval(function(){a:{var a=parseInt(c,10);var f=Date.now();if(f<=a){var e=null;var g=a-f;f=Math.floor(g/36E5);a=Math.floor(g/6E4%60);g=Math.floor(g/1E3%60);if(24<=f&&b.dataset.dayscountdowntoendtemplate&&
(e=b.dataset.dayscountdowntoendtemplate,null!==e)){e=e.replace("${daysCount}",Math.floor(f/24).toString());b.innerText=e;break a}b.dataset.minutescountdowntoendtemplate&&b.dataset.hourscountdowntoendtemplate&&(e=0===f?b.dataset.minutescountdowntoendtemplate:b.dataset.hourscountdowntoendtemplate);null!==e&&(e=e.replace("_hours_",w(f)),e=e.replace("_minutes_",w(a)),e=e.replace("_seconds_",w(g)),b.innerText=e)}else b.dataset.expiredstring&&(b.innerText=b.dataset.expiredstring)}},1E3)}},ia=function(){var a,
b=g["default"].cardRoot.getElementsByClassName("a-carousel-card");try{for(var c=k.__values(b),d=c.next();!d.done;d=c.next())ha(d.value)}catch(e){var f={error:e}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(f)throw f.error;}}};x._operationNames=["getCarouselItems"];x.card=function(){return k.__awaiter(void 0,void 0,void 0,function(){var a;return k.__generator(this,function(b){switch(b.label){case 0:return a=aa([ia]),[4,Z.initCarousel({afterPageLoaded:a})];case 1:return b.sent(),ea(),
[2]}})})}});
